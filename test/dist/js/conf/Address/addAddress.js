define("conf/Address/comAddress.js",function(require,e,t){function a(){var e=L.getnewItem("provinces");b(),e?n(e):d(0,1);var t=location.search.toLowerCase(),a=g.getParams();if(t.indexOf("source")>0&&(T.nextStep=T.nextStep+"?source="+a.source),t.indexOf("addressid")>0){T.isEdit=!0,T.addressId=a.addressId;var s=JSON.parse(address_detail);d(s.provinceId),d(s.cityId),d(s.boroughId)}T.isEdit&&u(),m(),h()}function s(){_.attr("disabled","disabled"),setTimeout(function(){_.removeAttr("disabled")},300)}function i(){var e=g.trimVal("username");p=!(!/^[a-zA-Z0-9\u4E00-\u9FA5]*$/.test(e)||g.getByteLen(e)<2||g.getByteLen(e)>20)}function r(){var e=y.getElementById("address");e.defaultValue=e.value;var t=g.trimVal("address");w=!(t.length<2||t.length>200)}function d(e,t){f.postData("/address/regiondivision",{parentId:e},function(t){if(t.data&&t.data.length>0)if(n(t.data),0===e)L.setItem("provinces",t.data);else{var a=t.data[0].level;switch(a){case 2:T.cities=t.data;break;case 3:T.areas=t.data;break;case 4:T.streets=t.data}}else T.streets=[{name:"全部区域",id:"0",level:4}],n([{name:"全部区域",id:"0",level:4}])})}function n(e){T.addrList=e}function o(){$("#cover_bj").hide(),$("#choose").css({transition:"bottom 1s ease-out","-moz-transition":"bottom 1s ease-out","-webkit-transition":"bottom 1s ease-out",bottom:"-200%"}),y.getElementById("choose").addEventListener("webkitTransitionEnd",c("choose",-1,0),!1),I.remliste()}function c(e,t,a){setTimeout(function(){$("#"+e).css({"z-index":t,opacity:t})},500)}function l(){var e=L.getnewItem("selected_address")||{};$(".areaSelectList li").each(function(t,a){switch(t){case 0:e.provinceId=this.getAttribute("addrid"),e.provinceName=this.innerHTML;break;case 1:e.cityId=this.getAttribute("addrid"),e.cityName=this.innerHTML;break;case 2:e.boroughId=this.getAttribute("addrid"),e.boroughName=this.innerHTML;break;case 3:"0"===this.getAttribute("addrid")?(e.areaId="",e.areaName=""):(e.areaId=this.getAttribute("addrid"),e.areaName=this.innerHTML)}}),L.setItem("selected_address",e)}function u(){if(address_detail){var e=JSON.parse(address_detail);$(".areaSelectList li").each(function(t,a){switch(t){case 0:this.setAttribute("addrid",e.provinceId),this.innerHTML=e.provinceName;break;case 1:this.setAttribute("addrid",e.cityId),this.innerHTML=e.cityName;break;case 2:this.setAttribute("addrid",e.boroughId),this.innerHTML=e.boroughName;break;case 3:this.setAttribute("addrid",e.areaId),this.innerHTML=e.areaName}}),L.setItem("selected_address",e)}}function b(){L.removeItem("selected_address")}function m(){var e=L.getnewItem("selected_address");return e&&k&&p&&w?($(".saveAddress").removeAttr("disabled"),!1):void $(".saveAddress").attr("disabled","disabled")}function h(){if(v){var e=$(".areaSelectList li"),t=1;e.each(function(a){e.eq(a).attr("level",t++)}),k=!0,p=!0,w=!0,$(".saveAddress").removeAttr("disabled")}}require("$");var v,f=require("utils/ajax"),g=require("lib/common"),L=require("mods/storage"),A=require("vendors/vue"),I=(require("mods/addressFun"),require("UI/alert"));"undefined"!=typeof address_detail&&(v=JSON.parse(address_detail)),g.init(),$(".w_goback").attr("href","javascript:;");var p=(location.search.substr(1),!1),k=!1,S=1,w=!1,y=window.document,T=new A({el:"#choose",data:{cities:[],areas:[],streets:[],addrList:[],isEdit:!1,addressId:0,nextStep:"/address/index"},methods:{selectChildAddr:function(e){if($(".areaSelectList li").attr("active","0").eq(e.level-1).attr({addrId:e.id,level:e.level}).html(e.name),4===e.level){$(".areaSelectList li").eq(e.level-1).attr("active","1");var t="";$(".areaSelectList li").each(function(){t+=this.innerHTML+" "}),$("#addressSelect").html(t),this.addrList=[],l(),o(),m()}else{$(".areaSelectList li").eq(e.level).attr("active","1").html("请选择");for(var a=e.level+1;4>=a;a++)$(".areaSelectList li").eq(a).attr("active","0").html("");d(e.id,e.level)}},changeAddr:function(e){var t=e.target;if(""===t.innerHTML||"1"===t.getAttribute("active")||"请选择"===t.innerHTML)return!1;var a=t.getAttribute("level");t.getAttribute("addrid");switch(a){case"1":this.addrList=L.getnewItem("provinces");break;case"2":this.addrList=this.cities;break;case"3":this.addrList=this.areas;break;case"4":this.addrList=this.streets}$(".areaSelectList li").attr("active","0").eq(parseInt(a-1)).attr("active","1").html("请选择"),$(".areaSelectList li").each(function(e){e>a-1&&(this.innerHTML="")})}}}),_=$("#addressSelect");$("#username").on("keyup",function(){i(),m()}),$("#username").on("blur",function(){return s(),i(),p?void m():(I.alerter("收货人姓名要2-20个字符"),!1)}),$("#address,#mobile").on("focus",function(){y.body.scrollTop="60"}),$("#mobile").on("keyup",function(){var e=g.trimVal("mobile"),t=e.slice(0,1);"0"===t?/^0[0-9]{10,11}$/.test(e)?k=!0:(k=!1,S=1):"1"===t?/^1[3-9][0-9]{9}$/.test(e)?k=!0:(k=!1,S=2):(k=!1,S=3),m()}),$("#mobile").on("blur",function(){if(s(),!k){switch(S){case 1:I.alerter("电话号输入错误");break;case 2:I.alerter("手机号输入错误");break;case 3:I.alerter("请重新输入电话号码")}return!1}}),$("#address").on("keyup",function(){r(),m()}),$("#address").on("blur",function(){return s(),r(),w?void m():(I.alerter("详细地址要2-200个字符"),!1)}),$(".saveAddress").on("click",function(){function e(e,t){0===e.code?(b(),I.alertSecond(t),location.assign(T.nextStep)):(I.alerter(e.message),a.removeAttribute("disabled"))}if("disabled"===this.getAttribute("disabled"))return!1;var t=L.getnewItem("selected_address"),a=this;t.userName=g.trimVal("username"),t.mobile=g.trimVal("mobile"),t.address=g.trimVal("address").replace("\r\n"," "),t.isDefault=T.isEdit?y.getElementById("isDefault").value:1,this.setAttribute("disabled","disabled"),v?(t.addressId=v.id,f.postData("/address/edit",t,function(t){e(t,"编辑收货地址成功")})):f.postData("/address/add",t,function(t){e(t,"新增地址设置成功")})}),$(".w_goback").on("click",function(){b(),location.assign("/address/index"+location.search)}),$(".goback").on("click",function(){b(),location.assign("/address/index"+location.search)}),_.on("click",function(){if("disabled"===this.getAttribute("disabled"))return!1;$("#cover_bj").show(),$("#choose").css({transition:"bottom 1s ease-out",bottom:"0%","-webkit-transition":"bottom 1s ease-out","-moz-transition":"bottom 1s ease-out","z-index":1e4,opacity:1});var e=$(".areaSelectList li").eq(3).attr("active");if(T.streets&&"1"===e){T.addrList=T.streets;var t=$(".areaSelectList li").eq(3).attr("addrid");T.addrList.length>0&&T.addrList.forEach(function(e,a){e.id==t?e.orderNo=1:e.orderNo=0})}}),a(),$("#choose").on("click","#close_choose",function(){o()})}),define("conf/Address/addAddress.js",function(require,e,t){require("conf/Address/comAddress")});